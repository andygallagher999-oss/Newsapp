<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåê Global Lens</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    min-height:100vh;padding:10px;padding-bottom:80px;
  }
  h1{color:white;text-align:center;margin-bottom:20px;font-size:2rem;text-shadow:0 2px 4px rgba(0,0,0,0.3);}
  .buttons-row{display:flex;justify-content:space-between;flex-wrap:wrap;margin-bottom:10px;}
  .buttons-row button{
    flex:1 1 80px;padding:10px 8px;margin:3px;
    border:none;border-radius:10px;cursor:pointer;
    background:#fff;color:#333;transition:0.3s;text-align:center;
  }
  .buttons-row button.active{background:linear-gradient(45deg,#667eea,#764ba2);color:white;}
  .separator{height:2px;background:rgba(255,255,255,0.3);margin:5px 0;}
  .news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:15px;}
  .news-card{background:white;border-radius:15px;overflow:hidden;
    box-shadow:0 8px 25px rgba(0,0,0,0.1);cursor:pointer;transition:all 0.3s;}
  .news-card:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(0,0,0,0.15);}
  .news-image{width:100%;height:180px;object-fit:cover;background:#f0f2f5;}
  .news-content{padding:15px;}
  .news-source{display:inline-block;background:linear-gradient(45deg,#667eea,#764ba2);
    color:white;padding:3px 8px;border-radius:12px;font-size:11px;font-weight:600;
    margin-bottom:8px;text-transform:uppercase;}
  .news-title{font-size:1.1rem;font-weight:700;color:#2c3e50;margin-bottom:8px;line-height:1.4;
    display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;}
  .news-summary{color:#555;line-height:1.5;font-size:0.9rem;
    display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;}
  .news-meta{display:flex;justify-content:space-between;align-items:center;
    padding-top:10px;border-top:1px solid #eee;font-size:0.85rem;color:#888;}
  .readFullBtn{background:linear-gradient(45deg,#ff6b6b,#feca57);border:none;
    color:white;padding:6px 12px;border-radius:8px;cursor:pointer;}
  .loading{text-align:center;color:white;font-size:1rem;margin:30px 0;padding:20px;display:none;}
  .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);
    display:none;justify-content:center;align-items:flex-end;z-index:1000;}
  .modal-card{background:white;width:100%;max-height:90%;border-radius:15px 15px 0 0;
    overflow:auto;padding:15px;transform:translateY(100%);transition:transform 0.3s ease;}
  .modal-card.show{transform:translateY(0);}
  #topBtn{
    position:fixed;bottom:20px;right:20px;z-index:1001;
    background:#667eea;color:white;border:none;border-radius:50%;
    width:50px;height:50px;font-size:14px;cursor:pointer;display:none;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
  }
</style>
</head>
<body>

<h1>üåê Global Lens</h1>

<!-- SOURCES -->
<div class="buttons-row sources">
  <button class="active" data-source="all">All</button>
  <button data-source="bbc">BBC</button>
  <button data-source="guardian">Guardian</button>
  <button data-source="techcrunch">TechCrunch</button>
  <button data-source="cnbc">CNBC</button>
  <button data-source="bloomberg">Bloomberg</button>
  <button data-source="otherfeeds">Other</button> <!-- Top-row Other -->
</div>

<div class="separator"></div>

<!-- CATEGORIES -->
<div class="buttons-row categories">
  <button class="active" data-category="all">All</button>
  <button data-category="world">World</button>
  <button data-category="business">Business</button>
  <button data-category="technology">Technology</button>
  <button data-category="science">Science</button>
  <button data-category="health">Health</button>
  <button data-category="sports">Sports</button>
  <button data-category="culture">Culture</button> <!-- Entertainment/Culture -->
</div>

<div class="loading" id="loading">Fetching news...</div>
<div class="news-grid" id="newsContainer"></div>

<div style="text-align:center;margin:15px;">
  <button id="loadMoreBtn" style="padding:10px 20px;border:none;border-radius:10px;
    background:#667eea;color:white;cursor:pointer;display:none;">Load More</button>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-card" id="modalCard"></div>
</div>

<button id="topBtn">Top</button>

<script>
const RSS_SOURCES = {
  bbc: {
    world:'https://feeds.bbci.co.uk/news/world/rss.xml',
    business:'https://feeds.bbci.co.uk/news/business/rss.xml',
    technology:'https://feeds.bbci.co.uk/news/technology/rss.xml',
    science:'https://feeds.bbci.co.uk/news/science_and_environment/rss.xml',
    health:'https://feeds.bbci.co.uk/news/health/rss.xml',
    sports:'https://feeds.bbci.co.uk/sport/rss.xml',
    culture:'https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml'
  },
  guardian: {
    world:'https://www.theguardian.com/world/rss',
    business:'https://www.theguardian.com/business/rss',
    technology:'https://www.theguardian.com/technology/rss',
    science:'https://www.theguardian.com/science/rss',
    health:'https://www.theguardian.com/society/health/rss',
    sports:'https://www.theguardian.com/sport/rss',
    culture:'https://www.theguardian.com/culture/rss'
  },
  techcrunch:{ technology:'https://techcrunch.com/feed/' },
  cnbc:{ business:'https://www.cnbc.com/id/100003114/device/rss/rss.html' },
  bloomberg:{ business:'https://feeds.bloomberg.com/markets/news.rss' },

  /* Top-row Other feeds (entertainment/music) */
  otherfeeds:{
    culture:[
      'https://www.npr.org/rss/rss.php?id=1008',
      'https://www.billboard.com/feed/',
      'https://pitchfork.com/feed/',
      'https://ew.com/feed/'
    ]
  }
};

function formatDate(d){
  const date=new Date(d),now=new Date();
  const diffH=Math.floor((now-date)/3600000);
  const diffD=Math.floor(diffH/24);
  if(diffH<1) return'Just now';
  if(diffH<24) return diffH+'h ago';
  if(diffD<7) return diffD+'d ago';
  return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}
function generateSummary(text){
  if(!text) return'';
  text=text.replace(/<[^>]*>/g,'').replace(/&[^;]+;/g,' ');
  return text.length>300?text.substring(0,300)+'...':text;
}
function getFallbackImage(){return 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=200&fit=crop';}

let allArticles=[],displayedCount=0;

async function parseRSS(url,src,cat){
  try{
    const proxy=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&count=10`;
    const res=await fetch(proxy); const data=await res.json();
    if(data.status!=='ok') return [];
    return data.items.map(i=>({source:src,category:cat,item:i}));
  }catch{ return []; }
}

function createNewsCard(article){
  const card=document.createElement('div'); card.className='news-card';
  const img=document.createElement('img'); img.className='news-image';
  img.src=article.item.thumbnail||getFallbackImage();
  img.onerror=()=>img.src=getFallbackImage();
  card.appendChild(img);

  const content=document.createElement('div'); content.className='news-content';
  const srcDiv=document.createElement('div'); srcDiv.className='news-source'; srcDiv.textContent=article.source;
  const title=document.createElement('h3'); title.className='news-title'; title.textContent=article.item.title;
  const summary=document.createElement('p'); summary.className='news-summary'; summary.textContent=generateSummary(article.item.content||article.item.description);
  const meta=document.createElement('div'); meta.className='news-meta';
  const dateSpan=document.createElement('span'); dateSpan.textContent=formatDate(article.item.pubDate);
  const btn=document.createElement('button'); btn.textContent='Read Full Article'; btn.className='readFullBtn';
  btn.onclick=e=>{e.stopPropagation();window.open(article.item.link,'_blank');};
  meta.append(dateSpan,btn);
  content.append(srcDiv,title,summary,meta);
  card.appendChild(content);
  card.addEventListener('click',()=>{
    const modalOverlay=document.getElementById('modalOverlay');
    const modalCard=document.getElementById('modalCard');
    modalCard.innerHTML=`<h2>${article.item.title}</h2><p>${generateSummary(article.item.content||article.item.description)}</p>
    <button onclick="window.open('${article.item.link}','_blank')">Read Full Article</button>`;
    modalOverlay.style.display='flex';
    setTimeout(()=>modalCard.classList.add('show'),50);
  });
  return card;
}

async function fetchNews(source='all',category='all'){
  document.getElementById('loading').style.display='block';
  document.getElementById('newsContainer').innerHTML='';
  displayedCount=0; allArticles=[];
  const srcList = source==='all' ? Object.keys(RSS_SOURCES) : [source];

  const tasks=[];
  for(const src of srcList){
    const cats = category==='all' ? Object.keys(RSS_SOURCES[src]) : [category];
    for(const cat of cats){
      const feeds = Array.isArray(RSS_SOURCES[src][cat]) ? RSS_SOURCES[src][cat] : [RSS_SOURCES[src][cat]];
      for(const feed of feeds){
        if(feed) tasks.push(parseRSS(feed,src,cat));
      }
    }
  }
  const results = await Promise.all(tasks);
  const combined = results.flat();

  // Balanced interleave: round-robin by source, newest first per source
  const grouped = {};
  combined.forEach(a=>{
    if(!grouped[a.source]) grouped[a.source]=[];
    grouped[a.source].push(a);
  });
  for(const s in grouped){
    grouped[s].sort((a,b)=>new Date(b.item.pubDate)-new Date(a.item.pubDate));
  }
  let finished=false;
  while(!finished){
    finished=true;
    for(const s in grouped){
      if(grouped[s].length){
        allArticles.push(grouped[s].shift());
        finished=false;
      }
    }
  }

  displayNextBatch();
  document.getElementById('loading').style.display='none';
}

function displayNextBatch(batchSize=6){
  const container=document.getElementById('newsContainer');
  const slice=allArticles.slice(displayedCount,displayedCount+batchSize);
  slice.forEach(a=>container.appendChild(createNewsCard(a)));
  displayedCount+=slice.length;
  document.getElementById('loadMoreBtn').style.display=(displayedCount<allArticles.length)?'block':'none';
}

document.getElementById('loadMoreBtn').onclick=()=>displayNextBatch();

document.querySelectorAll('.sources button').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.sources button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const cat=document.querySelector('.categories button.active').dataset.category;
    fetchNews(btn.dataset.source,cat);
  };
});
document.querySelectorAll('.categories button').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.categories button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const src=document.querySelector('.sources button.active').dataset.source;
    fetchNews(src,btn.dataset.category);
  };
});
document.getElementById('modalOverlay').onclick=e=>{
  if(e.target.id==='modalOverlay'){
    const modalCard=document.getElementById('modalCard');
    modalCard.classList.remove('show');
    setTimeout(()=>{document.getElementById('modalOverlay').style.display='none';},300);
  }
};

// Scroll-to-top floating button
const topBtn=document.getElementById('topBtn');
window.addEventListener('scroll',()=>{
  topBtn.style.display = window.scrollY>300 ? 'block':'none';
});
topBtn.onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

// Initial load
fetchNews();
</script>

</body>
</html>
