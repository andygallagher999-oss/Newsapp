<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; }
h1 { text-align:center; padding:1rem; }
.tabs, .categories { display:flex; flex-wrap:wrap; justify-content:center; margin-bottom:0.5rem; background:#fff; border-bottom:1px solid #ccc; }
.tab-btn, .cat-btn { padding:0.5rem 1rem; cursor:pointer; border:none; background:none; font-size:1rem; }
.tab-btn.active, .cat-btn.active { border-bottom:3px solid #007BFF; font-weight:bold; }
#feed { padding:1rem; max-width:900px; margin:0 auto; }
.news-card { background:#fff; margin:1rem 0; padding:1rem; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.news-card img { max-width:100%; border-radius:6px; margin-bottom:0.5rem; }
.source { font-size:0.8rem; color:#555; margin-bottom:0.3rem; }
.markets-container { display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:1rem; }
.market-card { flex:1 1 120px; background:#e6f0ff; padding:0.5rem; border-radius:8px; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,0.1); font-size:0.9rem; }
</style>
</head>
<body>

<h1>Global Lens</h1>

<!-- Source Buttons -->
<div class="tabs" id="sourceTabs">
  <button class="tab-btn active" data-tab="all">All</button>
  <button class="tab-btn" data-tab="guardian">The Guardian</button>
  <button class="tab-btn" data-tab="billboard">Billboard</button>
  <button class="tab-btn" data-tab="npr">NPR</button>
  <button class="tab-btn" data-tab="crunch">TechCrunch</button>
  <button class="tab-btn" data-tab="bbc">BBC</button>
  <button class="tab-btn" data-tab="cnbc">CNBC</button>
  <button class="tab-btn" data-tab="bloomberg">Bloomberg</button>
  <button class="tab-btn" data-tab="markets">Markets</button>
</div>

<!-- Category Buttons -->
<div class="categories" id="categoryTabs">
  <button class="cat-btn active" data-category="all">All</button>
  <button class="cat-btn" data-category="world">World</button>
  <button class="cat-btn" data-category="business">Business</button>
  <button class="cat-btn" data-category="technology">Technology</button>
  <button class="cat-btn" data-category="sports">Sports</button>
  <button class="cat-btn" data-category="culture">Culture</button>
</div>

<div id="feed">Loading...</div>

<script>
const RSS2JSON_API_KEY = 'tv1jlyo8aydiiehkz19nesknmhi2xk1gx0kaw23j';
const FINNHUB_API_KEY = 'YOUR_FINNHUB_API_KEY_HERE';

// Feed definitions
const feeds = {
  guardian: [{url:'https://www.theguardian.com/world/rss', name:'The Guardian'}],
  billboard: [{url:'https://www.billboard.com/feed/', name:'Billboard'}],
  npr: [{url:'https://www.npr.org/rss/rss.php?id=1019', name:'NPR'}],
  crunch: [{url:'https://feeds.feedburner.com/TechCrunch/', name:'TechCrunch'}],
  bbc: [
    {url:'https://feeds.bbci.co.uk/news/world/rss.xml', name:'BBC World'},
    {url:'https://feeds.bbci.co.uk/news/business/rss.xml', name:'BBC Business'},
    {url:'https://feeds.bbci.co.uk/news/technology/rss.xml', name:'BBC Tech'},
    {url:'https://feeds.bbci.co.uk/sport/rss.xml', name:'BBC Sports'}
  ],
  cnbc: [{url:'https://www.cnbc.com/id/100003114/device/rss/rss.html', name:'CNBC'}],
  bloomberg: [{url:'https://www.bloomberg.com/feed/podcast', name:'Bloomberg'}]
};

const markets = [
  {name:'S&P500','symbol':'^GSPC'},
  {name:'Dow','symbol':'^DJI'},
  {name:'Nasdaq','symbol':'^IXIC'},
  {name:'TSX','symbol':'^GSPTSE'}
];

let activeSource = 'all';
let activeCategory = 'all';

// --- RSS Fetch ---
async function parseRSS(url){
  try {
    const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&api_key=${RSS2JSON_API_KEY}&count=20`);
    const data = await res.json();
    return data.items || [];
  } catch(e){
    console.error('RSS failed', url, e);
    return [];
  }
}

// --- Market Data Fetch ---
async function fetchMarket(symbol){
  try {
    const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
    const data = await res.json();
    return data;
  } catch(e){ console.error('Market fetch failed', symbol, e); return null; }
}

// --- Render Markets ---
async function renderMarkets(){
  const container = document.getElementById('feed');
  container.innerHTML='';
  const marketDiv = document.createElement('div');
  marketDiv.className='markets-container';
  for(const m of markets){
    const d = await fetchMarket(m.symbol);
    const changePercent = d && d.c ? ((d.c - d.pc)/d.pc*100).toFixed(2) : '--';
    const dir = changePercent>0 ? '▲' : (changePercent<0 ? '▼':'');
    const color = changePercent>0?'green':(changePercent<0?'red':'#000');
    const card = document.createElement('div');
    card.className='market-card';
    card.innerHTML=`<div>${m.name}</div>
                    <div style="font-weight:bold">${d && d.c ? d.c.toFixed(2) : '--'}</div>
                    <div style="color:${color}">${dir} ${changePercent}%</div>`;
    marketDiv.appendChild(card);
  }
  container.appendChild(marketDiv);
}

// --- Render News ---
async function renderNews(){
  const container = document.getElementById('feed');
  container.innerHTML='Fetching...';
  let items=[];

  // Determine feeds
  let selectedFeeds = [];
  if(activeSource==='all'){
    selectedFeeds = Object.values(feeds).flat();
  } else if(feeds[activeSource]){
    selectedFeeds = feeds[activeSource];
  }

  for(const f of selectedFeeds){
    const rssItems = await parseRSS(f.url);
    rssItems.forEach(item => item.source = f.name);
    items = items.concat(rssItems);
  }

  // Filter by category if not 'all'
  if(activeCategory!=='all'){
    items = items.filter(i=> i.categories && i.categories.includes(activeCategory));
  }

  // Sort by date
  items.sort((a,b)=> new Date(b.pubDate)-new Date(a.pubDate));

  container.innerHTML='';
  for(const i of items){
    const card=document.createElement('div');
    card.className='news-card';
    card.innerHTML=`<div class="source">${i.source}</div>
                    <div class="title"><a href="${i.link}" target="_blank">${i.title}</a></div>
                    ${i.thumbnail?`<img src="${i.thumbnail}"/>`:''}
                    <div class="description">${i.description}</div>`;
    container.appendChild(card);
  }
}

// --- Tab Handling ---
document.querySelectorAll('.tab-btn').forEach(b=>{
  b.addEventListener('click', async ()=>{
    document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.remove('active'));
    b.classList.add('active');
    activeSource = b.dataset.tab;
    if(activeSource==='markets'){
      await renderMarkets();
    } else {
      await renderNews();
    }
  });
});

// --- Category Handling ---
document.querySelectorAll('.cat-btn').forEach(c=>{
  c.addEventListener('click', async ()=>{
    document.querySelectorAll('.cat-btn').forEach(btn=>btn.classList.remove('active'));
    c.classList.add('active');
    activeCategory = c.dataset.category;
    if(activeSource!=='markets'){
      await renderNews();
    }
  });
});

// --- Initial Load ---
renderNews();

</script>
</body>
</html>
