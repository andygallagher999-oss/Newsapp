<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin:0; padding:0; min-height:100vh;
}
.container {
    max-width: 1200px; margin:0 auto; padding:10px;
}
.header {
    text-align:center; color:white; margin-bottom:20px;
}
.header h1 { font-size:clamp(1.8rem,5vw,2.5rem); margin-bottom:5px; }
.header #lastUpdated { font-size:0.9rem; display:block; margin-top:5px; }
button { cursor:pointer; border:none; border-radius:10px; padding:10px 15px; margin:5px; }
.sources button.active, .categories button.active { box-shadow:0 0 8px #fff; }
.news-grid { display:grid; gap:20px; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); }
.news-card { background:white; border-radius:15px; overflow:hidden; cursor:pointer; transition:0.3s; }
.news-card:hover { transform:translateY(-3px); box-shadow:0 10px 25px rgba(0,0,0,0.15);}
.news-image { width:100%; height:180px; object-fit:cover; background:#f0f2f5;}
.news-content { padding:15px; }
.news-source { background:linear-gradient(45deg,#667eea,#764ba2); color:white; padding:3px 8px; border-radius:12px; font-size:11px; font-weight:600; margin-bottom:8px; display:inline-block; text-transform:uppercase;}
.news-title { font-weight:700; margin-bottom:8px; line-height:1.3; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;}
.news-summary { font-size:0.9rem; color:#555; display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden; line-height:1.4;}
.news-meta { display:flex; justify-content:space-between; font-size:0.85rem; color:#888; margin-top:10px;}
#loadMoreBtn { display:block; margin:20px auto; background:#ff6b6b; color:white; font-weight:600;}
#modalOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:flex-end; padding:10px; z-index:1000;}
#modalCard { background:white; width:100%; max-height:90%; border-radius:15px; overflow:auto; padding:15px; transform:translateY(100%); transition:transform 0.3s ease;}
#modalCard.show { transform:translateY(0);}
.sources, .categories { display:flex; flex-wrap:wrap; justify-content:center; margin-bottom:10px; }
.categories { border-top:1px solid rgba(255,255,255,0.3); padding-top:5px; margin-top:5px; }
@media (max-width:768px){
    .news-grid { grid-template-columns:1fr 1fr; }
    button { flex:1 1 45%; padding:12px 10px; margin:3px; font-size:0.9rem;}
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Global Lens</h1>
        <span id="lastUpdated"></span>
    </div>

    <div class="sources">
        <button class="active" data-source="mixed">Mixed</button>
        <button data-source="bbc">BBC</button>
        <button data-source="guardian">Guardian</button>
    </div>
    <div class="categories">
        <button class="active" data-category="all">All</button>
        <button data-category="world">World</button>
        <button data-category="business">Business</button>
        <button data-category="technology">Technology</button>
        <button data-category="science">Science</button>
        <button data-category="health">Health</button>
        <button data-category="sports">Sports</button>
        <button data-category="entertainment">Entertainment</button>
    </div>

    <div id="loading" style="text-align:center;color:white;margin:20px;">Loading news...</div>
    <div id="newsContainer" class="news-grid"></div>
    <button id="loadMoreBtn">Load More</button>
</div>

<div id="modalOverlay">
    <div id="modalCard"></div>
</div>

<script>
const RSS_SOURCES = {
    bbc: {
        world:'http://feeds.bbci.co.uk/news/world/rss.xml',
        business:'http://feeds.bbci.co.uk/news/business/rss.xml',
        technology:'http://feeds.bbci.co.uk/news/technology/rss.xml',
        science:'http://feeds.bbci.co.uk/news/science_and_environment/rss.xml',
        health:'http://feeds.bbci.co.uk/news/health/rss.xml',
        sports:'http://feeds.bbci.co.uk/sport/rss.xml',
        entertainment:'http://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml'
    },
    guardian: {
        world:'https://www.theguardian.com/world/rss',
        business:'https://www.theguardian.com/business/rss',
        technology:'https://www.theguardian.com/technology/rss',
        science:'https://www.theguardian.com/science/rss',
        health:'https://www.theguardian.com/society/health/rss',
        sports:'https://www.theguardian.com/sport/rss',
        entertainment:'https://www.theguardian.com/culture/rss'
    }
};

let allArticles=[], displayedCount=0;

function formatDate(dStr){
    const d=new Date(dStr), now=new Date();
    const diff=(now-d)/1000;
    if(diff<3600) return 'Just now';
    if(diff<86400) return Math.floor(diff/3600)+'h ago';
    if(diff<604800) return Math.floor(diff/86400)+'d ago';
    return d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function generateSummary(text){ 
    if(!text) return ''; 
    text=text.replace(/<[^>]*>/g,'').replace(/&[^;]+;/g,' ').trim(); 
    return text.length>400? text.substring(0,400)+'...' : text; 
}

function createNewsCard(article, sourceName, category){
    const card=document.createElement('div');
    card.className='news-card';
    card.dataset.link=article.link;
    card.dataset.source=sourceName;
    card.dataset.category=category;
    card.innerHTML=`<img src="" class="news-image">
        <div class="news-content">
            <div class="news-source">${sourceName}</div>
            <h3 class="news-title">${article.title}</h3>
            <p class="news-summary">${generateSummary(article.description)}</p>
            <div class="news-meta"><span class="news-date">${formatDate(article.pubDate)}</span>
            <span class="read-more">Read More â†’</span></div></div>`;
    card.addEventListener('click',()=>{
        const modal=document.getElementById('modalOverlay');
        const modalCard=document.getElementById('modalCard');
        modalCard.innerHTML=card.innerHTML+`<button onclick="window.open('${article.link}','_blank');event.stopPropagation();">Read Full Article</button>`;
        modal.style.display='flex';
        setTimeout(()=>{modalCard.classList.add('show');},50);
    });
    return card;
}

async function parseRSSFeed(rssUrl, sourceName, category){
    try{
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
        const data = await response.json();
        const parser = new DOMParser();
        const xml = parser.parseFromString(data.contents,"text/xml");
        const items = Array.from(xml.querySelectorAll("item")).map(item=>({
            title:item.querySelector("title")?.textContent,
            description:item.querySelector("description")?.textContent,
            link:item.querySelector("link")?.textContent,
            pubDate:item.querySelector("pubDate")?.textContent
        }));
        return items.map(i=>({source:sourceName,item:i,category:category}));
    }catch(e){ console.error(`Error fetching ${sourceName}:`,e); return []; }
}

async function fetchNews(source='mixed', category='all'){
    document.getElementById('loading').style.display='block';
    document.getElementById('newsContainer').innerHTML=''; displayedCount=0; allArticles=[];
    let sources = source==='mixed'? ['bbc','guardian'] : [source];
    for(const src of sources){
        let cats = category==='all'? Object.keys(RSS_SOURCES[src]) : [category];
        for(const cat of cats){
            const articles = await parseRSSFeed(RSS_SOURCES[src][cat],src,cat);
            allArticles.push(...articles);
        }
    }
    allArticles.sort((a,b)=> new Date(b.item.pubDate)-new Date(a.item.pubDate));
    document.getElementById('lastUpdated').textContent='Last updated: '+new Date().toLocaleString();
    displayNextBatch();
    document.getElementById('loading').style.display='none';
}

function displayNextBatch(batchSize=6){
    const container=document.getElementById('newsContainer');
    const slice=allArticles.slice(displayedCount,displayedCount+batchSize);
    slice.forEach(article=>container.appendChild(createNewsCard(article.item, article.source, article.category)));
    displayedCount+=slice.length;
    document.getElementById('loadMoreBtn').style.display=(displayedCount<allArticles.length)?'block':'none';
}

document.getElementById('loadMoreBtn').addEventListener('click',()=>displayNextBatch());

document.querySelectorAll('.sources button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.sources button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        fetchNews(btn.dataset.source,document.querySelector('.categories button.active').dataset.category);
    });
});

document.querySelectorAll('.categories button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.categories button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        fetchNews(document.querySelector('.sources button.active').dataset.source,btn.dataset.category);
    });
});

document.getElementById('modalOverlay').addEventListener('click',e=>{
    if(e.target.id==='modalOverlay'){
        document.getElementById('modalCard').classList.remove('show');
        setTimeout(()=>{document.getElementById('modalOverlay').style.display='none';},300);
    }
});

fetchNews();
</script>
</body>
</html>
