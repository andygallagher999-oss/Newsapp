<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
h1 { text-align:center; padding:1rem; }
.tab-buttons, .category-buttons { display:flex; flex-wrap:wrap; justify-content:center; gap:0.5rem; padding:0.5rem; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
.tab-buttons button, .category-buttons button { padding:0.5rem 1rem; border:none; border-radius:8px; background:#007bff; color:#fff; cursor:pointer; }
.tab-buttons button.active, .category-buttons button.active { background:#0056b3; }
.tab-content { display:none; padding:1rem; max-width:1200px; margin:auto; }
.news-grid { display:grid; gap:1rem; }
@media(min-width:1024px){ .news-grid { grid-template-columns: repeat(3, 1fr); } }
@media(min-width:600px) and (max-width:1023px){ .news-grid { grid-template-columns: repeat(2, 1fr); } }
@media(max-width:599px){ .news-grid { grid-template-columns: 1fr; } }
.news-card, .market-card { background:white; border-radius:12px; padding:1rem; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
.news-card img { width:100%; height:180px; object-fit:cover; border-radius:8px; margin-bottom:0.5rem; }
.news-title { font-weight:bold; margin-bottom:0.5rem; }
.news-desc { font-size:0.9rem; color:#333; margin-bottom:0.5rem; display:none; }
.news-source { font-size:0.8rem; color:#666; }
.market-card { text-align:center; max-width:180px; margin:auto; }
#loading { text-align:center; padding:1rem; font-weight:bold; }
</style>
</head>
<body>

<h1>Global Lens</h1>

<div class="tab-buttons">
  <button onclick="showTab('all')" class="active">All</button>
  <button onclick="showTab('guardian')">The Guardian</button>
  <button onclick="showTab('billboard')">Billboard</button>
  <button onclick="showTab('npr')">NPR</button>
  <button onclick="showTab('crunch')">Crunch</button>
  <button onclick="showTab('bbc')">BBC</button>
  <button onclick="showTab('cnbc')">CNBC</button>
  <button onclick="showTab('bloomberg')">Bloomberg</button>
  <button onclick="showTab('markets')">Markets</button>
</div>

<div id="categoryContainer" class="category-buttons"></div>

<div id="all" class="tab-content"><div class="news-grid"></div></div>
<div id="guardian" class="tab-content"><div class="news-grid"></div></div>
<div id="billboard" class="tab-content"><div class="news-grid"></div></div>
<div id="npr" class="tab-content"><div class="news-grid"></div></div>
<div id="crunch" class="tab-content"><div class="news-grid"></div></div>
<div id="bbc" class="tab-content"><div class="news-grid"></div></div>
<div id="cnbc" class="tab-content"><div class="news-grid"></div></div>
<div id="bloomberg" class="tab-content"><div class="news-grid"></div></div>
<div id="markets" class="tab-content"></div>

<div id="loading">Fetching articles...</div>

<script>
const apiKey = 'tv1jlyo8aydiiehkz19nesknmhi2xk1gx0kaw23j';
let currentTab = 'all';
let currentCategory = '';
let pageCounts = {};

const feedUrls = {
  guardian: 'https://www.theguardian.com/world/rss',
  billboard: 'https://www.billboard.com/feed/',
  npr: 'https://www.npr.org/rss/rss.php?id=1019',
  crunch: 'https://feeds.feedburner.com/TechCrunch/',
  bbc: 'http://feeds.bbci.co.uk/news/world/rss.xml',
  cnbc: 'https://www.cnbc.com/id/100003114/device/rss/rss.html',
  bloomberg: 'https://feeds.bloomberg.com/markets/news.rss'
};

const categories = ['World', 'Business', 'Technology', 'Sports', 'Culture', 'Health'];

// Market symbols and cards
const marketSymbols = ["^GSPC","^DJI","^IXIC","^TSX"];
async function loadMarkets() {
  const container = document.getElementById('markets');
  container.innerHTML = '';
  for(const s of marketSymbols){
    try {
      const res = await fetch(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${s}`);
      const data = await res.json();
      const q = data.quoteResponse.result[0];
      const card = document.createElement('div');
      card.className = 'market-card';
      card.innerHTML = `<div>${q.shortName || s}</div>
                        <div>Price: ${q.regularMarketPrice}</div>
                        <div>Change: ${q.regularMarketChange.toFixed(2)} (${q.regularMarketChangePercent.toFixed(2)}%)</div>`;
      container.appendChild(card);
    } catch(e){ console.error(e); }
  }
}

// Show/hide tabs
function showTab(tab) {
  currentTab = tab;
  currentCategory = '';
  pageCounts[tab] = 1;
  document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
  document.getElementById(tab).style.display='block';
  document.querySelectorAll('.tab-buttons button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.tab-buttons button[onclick="showTab('${tab}')"]`).classList.add('active');

  // Show categories except for Markets
  const catContainer = document.getElementById('categoryContainer');
  catContainer.style.display = tab==='markets' ? 'none' : 'flex';
  catContainer.innerHTML = categories.map(c=>`<button onclick="filterCategory('${c}')" ${currentCategory===c?'class="active"':''}>${c}</button>`).join('');

  if(tab==='markets'){ loadMarkets(); }
  else { loadFeed(tab, true); }
}

function filterCategory(cat){
  currentCategory = cat;
  document.querySelectorAll('.category-buttons button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  loadFeed(currentTab, true);
}

// Load RSS feed into a tab with optional reset
async function loadFeed(tab, reset=false){
  if(!feedUrls[tab] && tab!=='all') return;
  const container = document.getElementById(tab).querySelector('.news-grid');
  if(reset) container.innerHTML='';
  document.getElementById('loading').style.display='block';

  const urls = tab==='all' ? Object.values(feedUrls) : [feedUrls[tab]];
  for(const url of urls){
    try {
      const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&api_key=${apiKey}&count=12`);
      const data = await res.json();
      if(data.status==='ok'){
        data.items.forEach(item=>{
          if(currentCategory && !item.categories.some(c => c.includes(currentCategory))) return;
          const card = document.createElement('div');
          card.className = 'news-card';
          card.innerHTML = `<img src="${item.enclosure?.link || item.thumbnail || ''}" onerror="this.style.display='none'"/>
                            <div class="news-title">${item.title}</div>
                            <div class="news-desc">${item.description}</div>
                            <div class="news-source">${item.source || url}</div>`;
          card.addEventListener('click',()=>{ 
            const desc = card.querySelector('.news-desc'); 
            desc.style.display = desc.style.display==='none'?'block':'none';
          });
          container.appendChild(card);
        });
      }
    } catch(e){ console.error('Failed RSS', url, e); }
  }
  document.getElementById('loading').style.display='none';
}

// Infinite scroll
window.addEventListener('scroll', () => {
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 300){
    if(currentTab !== 'markets') loadFeed(currentTab);
  }
});

showTab('all');
</script>
</body>
</html>
