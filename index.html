<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Lens</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    header {
      background: #0d47a1;
      color: #fff;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
    }
    #news-container {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(350px,1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .news-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
    }
    .news-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .content {
      padding: 1rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .title {
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .meta {
      color: #666;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
    }
    .summary {
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
    }
    .expanded {
      -webkit-line-clamp: unset;
    }
    .buttons {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .read-more {
      background: #0d47a1;
      color: #fff;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .full-link {
      font-size: 0.85rem;
      color: #0d47a1;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>Global Lens</header>
  <div id="news-container"></div>

  <script>
    const FEEDS = [
      // Your working feeds here (removed BBC & NPR to avoid 429 errors)
      "https://feeds.theguardian.com/theguardian/world/rss",
      "https://www.aljazeera.com/xml/rss/all.xml",
      "https://www.bloomberg.com/feed/podcast/etf-report.xml"
    ];

    const RSS2JSON = "https://api.rss2json.com/v1/api.json?api_key=tv1jlyo8aydiiehkz19nesknmhi2xk1gx0kaw23j&count=30&rss_url=";
    const PLACEHOLDER_IMG = "./assets/images/global-lens-logo.png";

    async function fetchRSS(url) {
      try {
        const res = await fetch(RSS2JSON + encodeURIComponent(url));
        if (!res.ok) throw new Error(res.status);
        const data = await res.json();
        return data.items.map(item => ({
          title: item.title,
          link: item.link,
          pubDate: new Date(item.pubDate).toLocaleString(),
          content: item.content,
          thumbnail: item.enclosure?.link || item.thumbnail || PLACEHOLDER_IMG
        }));
      } catch (err) {
        console.error("RSS Error", url, err);
        return [];
      }
    }

    async function fetchAll() {
      const all = await Promise.all(FEEDS.map(fetchRSS));
      return all.flat().sort((a,b) => new Date(b.pubDate) - new Date(a.pubDate));
    }

    function createCard(article) {
      const card = document.createElement("div");
      card.className = "news-card";

      const img = document.createElement("img");
      img.src = article.thumbnail || PLACEHOLDER_IMG;
      img.onerror = () => { img.src = PLACEHOLDER_IMG; };

      const content = document.createElement("div");
      content.className = "content";

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = article.title;

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = article.pubDate;

      const summary = document.createElement("div");
      summary.className = "summary";
      summary.innerHTML = article.content; // render full HTML safely

      const buttons = document.createElement("div");
      buttons.className = "buttons";

      const fullLink = document.createElement("a");
      fullLink.href = article.link;
      fullLink.target = "_blank";
      fullLink.className = "full-link";
      fullLink.textContent = "Read Full Article";

      const readMore = document.createElement("button");
      readMore.className = "read-more";
      readMore.textContent = "Read More";
      readMore.style.display = "none";

      readMore.addEventListener("click", () => {
        summary.classList.toggle("expanded");
        readMore.textContent = summary.classList.contains("expanded")
          ? "Read Less" : "Read More";
      });

      // show button only if content is taller than collapsed height
      setTimeout(() => {
        if (summary.scrollHeight > summary.clientHeight + 5) {
          readMore.style.display = "inline-block";
        }
      }, 100);

      buttons.appendChild(fullLink);
      buttons.appendChild(readMore);

      content.appendChild(title);
      content.appendChild(meta);
      content.appendChild(summary);
      content.appendChild(buttons);

      card.appendChild(img);
      card.appendChild(content);
      return card;
    }

    fetchAll().then(articles => {
      const container = document.getElementById("news-container");
      articles.forEach(a => container.appendChild(createCard(a)));
    });
  </script>
</body>
</html>
