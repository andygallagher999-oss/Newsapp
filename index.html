<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        min-height:100vh;
        padding:10px;
        padding-bottom:80px;
    }
    .container { max-width:1200px; margin:0 auto; }
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; }
    .header h1 { color:white; font-size:clamp(1.8rem,5vw,2.5rem); text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    .current-date { color:white; font-size:1rem; }
    .status-bar {
        background: rgba(46,204,113,0.15);
        color:#2ecc71;
        padding:10px;
        border-radius:8px;
        text-align:center;
        font-size:0.9rem;
        margin-bottom:15px;
        border:1px solid rgba(46,204,113,0.2);
    }
    .buttons-row { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:15px; }
    .button-group { display:flex; gap:10px; flex-wrap:wrap; }
    .button-group button {
        padding:10px 15px;
        border:none;
        border-radius:10px;
        font-size:14px;
        cursor:pointer;
        font-weight:600;
        transition:all 0.3s ease;
    }
    .button-group button.active { background:#ff6b6b; color:white; }
    .separator { width:100%; height:1px; background:rgba(255,255,255,0.3); margin:10px 0; }
    .news-grid {
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
        gap:20px;
        margin-top:20px;
    }
    .news-card {
        background:white;
        border-radius:15px;
        overflow:hidden;
        box-shadow:0 8px 25px rgba(0,0,0,0.1);
        transition:all 0.3s ease;
        opacity:0;
        transform:translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
        cursor:pointer;
        position:relative;
    }
    .news-card:hover { transform:translateY(-3px); box-shadow:0 15px 35px rgba(0,0,0,0.15); }
    .breaking-badge {
        position:absolute;
        top:10px;
        left:10px;
        background:red;
        color:white;
        font-weight:bold;
        padding:4px 8px;
        border-radius:5px;
        font-size:0.8rem;
        z-index:10;
    }
    @keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }
    .news-image { width:100%; height:180px; object-fit:cover; background:#e1e5e9; }
    .news-content { padding:18px; }
    .news-source { display:inline-block; background:linear-gradient(45deg,#667eea,#764ba2); color:white; padding:4px 10px; border-radius:15px; font-size:11px; font-weight:600; margin-bottom:10px; text-transform:uppercase; }
    .news-title { font-size:1.1rem; font-weight:700; color:#2c3e50; margin-bottom:10px; line-height:1.4; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
    .news-summary { color:#555; line-height:1.5; margin-bottom:12px; font-size:0.9rem; display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden; }
    .news-meta { display:flex; justify-content:space-between; align-items:center; padding-top:12px; border-top:1px solid #eee; font-size:0.85rem; color:#888; }
    .news-date { font-weight:500; }
    .read-more { color:#667eea; text-decoration:none; font-weight:600; font-size:0.85rem; }
    .loading { text-align:center; color:white; font-size:1rem; margin:30px 0; padding:20px; }
    .spinner { display:inline-block; width:25px; height:25px; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 1s ease-in-out infinite; margin-right:10px; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .error { background: rgba(255,107,107,0.15); color:#ff6b6b; padding:15px; border-radius:10px; text-align:center; margin:20px 0; border:1px solid rgba(255,107,107,0.2); }
    @media(max-width:768px){
        .news-grid{grid-template-columns:1fr;}
        .button-group button{flex:1; font-size:16px; padding:12px;}
    }
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üåê Global Lens</h1>
        <div class="current-date" id="currentDate"></div>
    </div>

    <div class="status-bar">
        ‚úÖ <strong>Ready to use!</strong> No API keys needed - powered by RSS feeds
    </div>

    <div class="buttons-row">
        <div class="button-group" id="sourceButtons"></div>
    </div>
    <div class="separator"></div>
    <div class="buttons-row">
        <div class="button-group" id="categoryButtons"></div>
    </div>

    <div id="loading" class="loading" style="display:none;">
        <div class="spinner"></div>Fetching news...
    </div>

    <div id="error" class="error" style="display:none;"></div>

    <div id="newsContainer" class="news-grid"></div>
</div>

<script>
const SOURCES=['mixed','bbc','guardian','nyt','techcrunch','npr'];
const CATEGORIES=['world','business','technology','science','health','sports','entertainment'];
const RSS_SOURCES={
    bbc:{world:'http://feeds.bbci.co.uk/news/world/rss.xml',business:'http://feeds.bbci.co.uk/news/business/rss.xml',technology:'http://feeds.bbci.co.uk/news/technology/rss.xml',science:'http://feeds.bbci.co.uk/news/science_and_environment/rss.xml',health:'http://feeds.bbci.co.uk/news/health/rss.xml',sports:'http://feeds.bbci.co.uk/sport/rss.xml',entertainment:'http://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml'},
    guardian:{world:'https://www.theguardian.com/world/rss',business:'https://www.theguardian.com/business/rss',technology:'https://www.theguardian.com/technology/rss',science:'https://www.theguardian.com/science/rss',health:'https://www.theguardian.com/society/health/rss',sports:'https://www.theguardian.com/sport/rss',entertainment:'https://www.theguardian.com/culture/rss'},
    nyt:{world:'https://rss.nytimes.com/services/xml/rss/nyt/World.xml',business:'https://rss.nytimes.com/services/xml/rss/nyt/Business.xml',technology:'https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml',science:'https://rss.nytimes.com/services/xml/rss/nyt/Science.xml',health:'https://rss.nytimes.com/services/xml/rss/nyt/Health.xml',sports:'https://rss.nytimes.com/services/xml/rss/nyt/Sports.xml',entertainment:'https://rss.nytimes.com/services/xml/rss/nyt/Arts.xml'},
    techcrunch:{world:'https://feeds.feedburner.com/TechCrunch/',business:'https://feeds.feedburner.com/TechCrunch/',technology:'https://feeds.feedburner.com/TechCrunch/',science:'https://feeds.feedburner.com/TechCrunch/',health:'https://feeds.feedburner.com/TechCrunch/',sports:'https://feeds.feedburner.com/TechCrunch/',entertainment:'https://feeds.feedburner.com/TechCrunch/'},
    npr:{world:'https://feeds.npr.org/1004/rss.xml',business:'https://feeds.npr.org/1019/rss.xml',technology:'https://feeds.npr.org/1015/rss.xml',science:'https://feeds.npr.org/1007/rss.xml',health:'https://feeds.npr.org/1128/rss.xml',sports:'https://feeds.npr.org/1014/rss.xml',entertainment:'https://feeds.npr.org/1007/rss.xml'}
};

let selectedSource='mixed';
let selectedCategory='world';

function formatDate(dateString){
    const date=new Date(dateString);
    const now=new Date();
    const diffTime=Math.abs(now-date);
    const diffHours=Math.floor(diffTime/(1000*60*60));
    const diffDays=Math.floor(diffTime/(1000*60*60*24));
    if(diffHours < 1) return 'Just now';
    if(diffHours < 24) return `${diffHours}h ago`;
    if(diffDays < 7) return `${diffDays}d ago`;
    return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function generateSummary(description,content){
    let text=description||content||'';
    text=text.replace(/<[^>]*>/g,'').replace(/&[^;]+;/g,' ');
    const sentences=text.split(/[.!?]+/);
    if(sentences.length>1&&sentences[0].length>50){
        return sentences.slice(0,2).join('. ').trim()+'.';
    }
    return text.length>200?text.substring(0,200).trim()+'...':text;
}

function getRandomImage(category){
    const images={
        world:['https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=200&fit=crop'],
        business:['https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=200&fit=crop'],
        technology:['https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=200&fit=crop'],
        science:['https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=400&h=200&fit=crop'],
        health:['https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=400&h=200&fit=crop'],
        sports:['https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=200&fit=crop'],
        entertainment:['https://images.unsplash.com/photo-1523475496153-3b3792e3aaec?w=400&h=200&fit=crop']
    };
    const categoryImages=images[category]||images.world;
    return categoryImages[Math.floor(Math.random()*categoryImages.length)];
}

function createNewsCard(article,isBreaking){
    const summary=generateSummary(article.description,article.content);
    const imageUrl=article.image||getRandomImage(selectedCategory);
    return `
        <div class="news-card" onclick="window.open('${article.link}','_blank')">
            ${isBreaking?'<div class="breaking-badge">Breaking</div>':''}
            <img src="${imageUrl}" class="news-image" onerror="this.src='${getRandomImage(selectedCategory)}'">
            <div class="news-content">
                <div class="news-source">${article.source}</div>
                <h3 class="news-title">${article.title}</h3>
                <p class="news-summary">${summary}</p>
                <div class="news-meta">
                    <span class="news-date">${formatDate(article.pubDate)}</span>
                    <span class="read-more">Read More ‚Üí</span>
                </div>
            </div>
        </div>
    `;
}

function displayNews(articles){
    const container=document.getElementById('newsContainer');
    container.innerHTML=articles.map((a,i)=>createNewsCard(a,i===0)).join('');
}

function showLoading(show){
    document.getElementById('loading').style.display=show?'block':'none';
}

function showError(msg){
    const errorDiv=document.getElementById('error');
    errorDiv.textContent=msg;
    errorDiv.style.display='block';
    setTimeout(()=>{errorDiv.style.display='none';},5000);
}

async function parseRSSFeed(url,sourceName){
    try{
        const proxy=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&api_key=&count=10`;
        const res=await fetch(proxy);
        const data=await res.json();
        if(data.status!=='ok') throw new Error(data.message||'Unknown error');
        return data.items.map(item=>({
            source:sourceName,
            title:item.title,
            description:item.description,
            content:item.content,
            link:item.link,
            pubDate:item.isoDate||item.pubDate,
            image:item.enclosure?.link
        }));
    }catch(e){
        console.error(`Error parsing ${sourceName}:`,e);
        return [];
    }
}

async function fetchNews(){
    showLoading(true);
    document.getElementById('newsContainer').innerHTML='';
    try{
        let allArticles=[];
        const sources=selectedSource==='mixed'?['bbc','guardian','nyt','techcrunch','npr']:[selectedSource];
        for(const s of sources){
            const url=RSS_SOURCES[s][selectedCategory];
            const sourceName=s==='nyt'?'New York Times':s==='bbc'?'BBC News':s==='guardian'?'The Guardian':s==='techcrunch'?'TechCrunch':'NPR';
            const items=await parseRSSFeed(url,sourceName);
            allArticles.push(...items);
        }
        if(allArticles.length===0) throw new Error('No articles found.');
        allArticles.sort((a,b)=>new Date(b.pubDate).getTime()-new Date(a.pubDate).getTime());
        displayNews(allArticles.slice(0,12));
    }catch(e){
        console.error(e);
        showError(`Failed to fetch news: ${e.message}`);
    }finally{showLoading(false);}
}

function setupButtons(){
    const sourceDiv=document.getElementById('sourceButtons');
    SOURCES.forEach(s=>{
        const btn=document.createElement('button');
        btn.textContent=s==='mixed'?'üì∞ Mixed':s==='bbc'?'üá¨üáß BBC':s==='guardian'?'üì∞ Guardian':s==='nyt'?'üì∞ NY Times':s==='techcrunch'?'üíª TechCrunch':'üéô NPR';
        btn.onclick=()=>{selectedSource=s;highlightActive(sourceDiv,btn);fetchNews();}
        if(s===selectedSource) btn.classList.add('active');
        sourceDiv.appendChild(btn);
    });
    const categoryDiv=document.getElementById('categoryButtons');
    CATEGORIES.forEach(c=>{
        const btn=document.createElement('button');
        btn.textContent=c==='world'?'üåç World':c==='business'?'üíº Business':c==='technology'?'üíª Technology':c==='science'?'üî¨ Science':c==='health'?'üè• Health':c==='sports'?'‚öΩ Sports':'üé¨ Entertainment';
        btn.onclick=()=>{selectedCategory=c;highlightActive(categoryDiv,btn);fetchNews();}
        if(c===selectedCategory) btn.classList.add('active');
        categoryDiv.appendChild(btn);
    });
}

function highlightActive(container,activeBtn){
    [...container.children].forEach(b=>b.classList.remove('active'));
    activeBtn.classList.add('active');
}

function updateCurrentDate(){
    const now=new Date();
    const options={weekday:'short',month:'short',day:'numeric',year:'numeric'};
    document.getElementById('currentDate').textContent=now.toLocaleDateString('en-US',options);
}

setupButtons();
updateCurrentDate();
setInterval(updateCurrentDate,60000);
fetchNews();
</script>
</body>
</html>
