<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
       background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
       min-height:100vh; padding:10px; color:#333; }
.container { max-width:1200px; margin:0 auto; }
.header { text-align:center; margin-bottom:15px; }
.header h1 { color:white; font-size:clamp(2rem,5vw,2.5rem); text-shadow:0 2px 4px rgba(0,0,0,0.3); display:inline-block; }
.header .last-updated { color:white; font-size:0.9rem; margin-left:15px; vertical-align:middle; }
.header p { color:rgba(255,255,255,0.9); font-size:1rem; margin-top:5px; }

.top-bar { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:10px; }
.sources,.categories { display:flex; gap:8px; flex-wrap:wrap; }
.sources button,.categories button { padding:10px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition: all 0.2s; font-size:0.9rem; }
.sources button { background:#ff6b6b; color:white; }
.categories button { background:#667eea; color:white; }
.sources button.active,.categories button.active { box-shadow:0 4px 10px rgba(0,0,0,0.3); }

.separator { display:none; width:100%; height:1px; background:rgba(255,255,255,0.4); margin:10px 0; }

.loading { text-align:center; color:white; font-size:1rem; margin:20px 0; }
.spinner { display:inline-block; width:25px; height:25px; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 1s ease-in-out infinite; margin-right:10px; }
@keyframes spin { to { transform:rotate(360deg); } }

.news-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-top:10px; }
.news-card { background:white; border-radius:15px; overflow:hidden; box-shadow:0 8px 25px rgba(0,0,0,0.1); cursor:pointer; transition:transform 0.2s, box-shadow 0.2s; position:relative; }
.news-card:hover { transform:translateY(-3px); box-shadow:0 15px 35px rgba(0,0,0,0.15); }
.news-image { width:100%; height:180px; object-fit:cover; background:#e1e5e9; }
.news-content { padding:15px; }
.news-source { display:inline-block; background:#764ba2; color:white; padding:4px 10px; border-radius:12px; font-size:11px; font-weight:600; margin-bottom:8px; text-transform:uppercase; }
.news-title { font-size:1.1rem; font-weight:700; color:#2c3e50; margin-bottom:6px; line-height:1.4; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
.news-summary { color:#555; font-size:0.9rem; line-height:1.4; display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:10px; transition:max-height 0.3s ease; }
.news-meta { display:flex; justify-content:space-between; font-size:0.85rem; color:#888; border-top:1px solid #eee; padding-top:8px; }
.read-more { color:#667eea; text-decoration:none; font-weight:600; }
.load-more-btn { padding:10px 20px; margin:20px auto; display:block; background:#ff6b6b; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.2s; }
.load-more-btn:hover { transform:scale(1.05); }

.modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999; justify-content:center; align-items:center; overflow:auto; padding:10px; }

.modal-card { background:white; border-radius:15px; max-width:600px; width:100%; max-height:80vh; overflow-y:auto; padding:20px; position:relative; }

.modal-card .news-title { -webkit-line-clamp:none; }
.modal-card .news-summary { -webkit-line-clamp:none; }

@media(max-width:768px){
    .news-grid { grid-template-columns:repeat(2,1fr); gap:15px; }
    .top-bar { flex-direction:column; gap:10px; }
    .separator { display:block; }
    .sources button,.categories button { font-size:1rem; padding:12px 16px; flex:1; }
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üåê Global Lens</h1>
        <span class="last-updated" id="lastUpdated"></span>
        <p>Live RSS feeds from trusted news sources worldwide</p>
    </div>

    <div class="top-bar">
        <div class="sources">
            <button data-source="mixed" class="active">All Sources</button>
            <button data-source="bbc">BBC</button>
            <button data-source="guardian">Guardian</button>
            <button data-source="nyt">NYT</button>
            <button data-source="techcrunch">TechCrunch</button>
        </div>
        <div class="separator"></div>
        <div class="categories">
            <button data-category="all" class="active">All</button>
            <button data-category="world">World</button>
            <button data-category="business">Business</button>
            <button data-category="technology">Technology</button>
            <button data-category="science">Science</button>
            <button data-category="health">Health</button>
            <button data-category="sports">Sports</button>
            <button data-category="entertainment">Entertainment</button>
        </div>
    </div>

    <div id="loading" class="loading" style="display:none;"><span class="spinner"></span>Fetching latest news...</div>
    <div id="newsContainer" class="news-grid"></div>
    <button id="loadMoreBtn" class="load-more-btn" style="display:none;">Load More</button>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal-card" id="modalCard"></div>
</div>

<script>
// RSS Sources
const RSS_SOURCES = {
    bbc: { world:'http://feeds.bbci.co.uk/news/world/rss.xml', business:'http://feeds.bbci.co.uk/news/business/rss.xml',
           technology:'http://feeds.bbci.co.uk/news/technology/rss.xml', science:'http://feeds.bbci.co.uk/news/science_and_environment/rss.xml',
           health:'http://feeds.bbci.co.uk/news/health/rss.xml', sports:'http://feeds.bbci.co.uk/sport/rss.xml',
           entertainment:'http://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml' },
    guardian: { world:'https://www.theguardian.com/world/rss', business:'https://www.theguardian.com/business/rss',
                technology:'https://www.theguardian.com/technology/rss', science:'https://www.theguardian.com/science/rss',
                health:'https://www.theguardian.com/society/health/rss', sports:'https://www.theguardian.com/sport/rss',
                entertainment:'https://www.theguardian.com/culture/rss' },
    nyt: { world:'https://rss.nytimes.com/services/xml/rss/nyt/World.xml', business:'https://rss.nytimes.com/services/xml/rss/nyt/Business.xml',
           technology:'https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml', science:'https://rss.nytimes.com/services/xml/rss/nyt/Science.xml',
           health:'https://rss.nytimes.com/services/xml/rss/nyt/Health.xml', sports:'https://rss.nytimes.com/services/xml/rss/nyt/Sports.xml',
           entertainment:'https://rss.nytimes.com/services/xml/rss/nyt/Arts.xml' },
    techcrunch: { world:'https://feeds.feedburner.com/TechCrunch/', business:'https://feeds.feedburner.com/TechCrunch/',
                  technology:'https://feeds.feedburner.com/TechCrunch/', science:'https://feeds.feedburner.com/TechCrunch/',
                  health:'https://feeds.feedburner.com/TechCrunch/', sports:'https://feeds.feedburner.com/TechCrunch/',
                  entertainment:'https://feeds.feedburner.com/TechCrunch/' }
};

let allArticles=[], displayedCount=0;

function formatDate(dateString){
    const d=new Date(dateString); const now=new Date();
    const diff=(now-d)/1000;
    if(diff<3600) return 'Just now';
    if(diff<86400) return Math.floor(diff/3600)+'h ago';
    if(diff<604800) return Math.floor(diff/86400)+'d ago';
    return d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function generateSummary(text){ 
    if(!text) return ''; 
    text=text.replace(/<[^>]*>/g,'').replace(/&[^;]+;/g,' ').trim(); 
    return text.length>400? text.substring(0,400)+'...' : text; 
}

function getRandomImage(category){
    const images={ world:['https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=200&fit=crop'],
                   business:['https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=200&fit=crop'],
                   technology:['https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=200&fit=crop'],
                   science:['https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=400&h=200&fit=crop'],
                   health:['https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=200&fit=crop'],
                   sports:['https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=200&fit=crop'],
                   entertainment:['https://images.unsplash.com/photo-1502920917128-1aa500764b7e?w=400&h=200&fit=crop'] };
    return images[category]?.[0] || images['world'][0];
}

function createNewsCard(article, sourceName, category){
    const card=document.createElement('div');
    card.className='news-card';
    card.dataset.link=article.link;
    card.dataset.source=sourceName;
    card.dataset.category=category;
    card.innerHTML=`<img src="${getRandomImage(category)}" class="news-image" onerror="this.src='${getRandomImage(category)}'">
        <div class="news-content">
            <div class="news-source">${sourceName}</div>
            <h3 class="news-title">${article.title}</h3>
            <p class="news-summary">${generateSummary(article.description)}</p>
            <div class="news-meta">
                <span class="news-date">${formatDate(article.pubDate)}</span>
                <span class="read-more">Read More ‚Üí</span>
            </div>
        </div>`;
    card.expanded=false;
    card.addEventListener('click', e=>{
        const modal=document.getElementById('modalOverlay');
        const modalCard=document.getElementById('modalCard');
        if(!card.expanded){
            modalCard.innerHTML=card.innerHTML;
            modal.style.display='flex';
            card.expanded=true;
        } else {
            window.open(article.link,'_blank');
        }
    });
    return card;
}

async function parseRSSFeed(url, sourceName, category){
    try{
        const proxy=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&count=12`;
        const res=await fetch(proxy);
        const data=await res.json();
        if(data.status!=='ok') throw new Error(data.message||'RSS parse failed');
        return data.items.map(i=>({source:sourceName,item:i,category:category}));
    }catch(e){ console.error(`Error fetching ${sourceName}:`,e); return []; }
}

async function fetchNews(source='mixed', category='all'){
    document.getElementById('loading').style.display='block';
    document.getElementById('newsContainer').innerHTML=''; displayedCount=0; allArticles=[];
    let sources = source==='mixed'? ['bbc','guardian','nyt','techcrunch'] : [source];
    for(const src of sources){
        let cats = category==='all'? Object.keys(RSS_SOURCES[src]) : [category];
        for(const cat of cats){
            const articles=await parseRSSFeed(RSS_SOURCES[src][cat], src.toUpperCase(), cat);
            allArticles.push(...articles);
        }
    }
    allArticles.sort((a,b)=>new Date(b.item.pubDate)-new Date(a.item.pubDate));
    document.getElementById('lastUpdated').textContent='Last updated: '+new Date().toLocaleTimeString();
    displayNextBatch();
    document.getElementById('loading').style.display='none';
}

function displayNextBatch(){
    const container=document.getElementById('newsContainer');
    const batch=allArticles.slice(displayedCount,displayedCount+12);
    batch.forEach(a=>container.appendChild(createNewsCard(a.item,a.source,a.category)));
    displayedCount+=batch.length;
    document.getElementById('loadMoreBtn').style.display = displayedCount<allArticles.length?'block':'none';
}

// Modal close
document.getElementById('modalOverlay').addEventListener('click',e=>{
    if(e.target.id==='modalOverlay'){
        e.target.style.display='none';
        document.querySelectorAll('.news-card').forEach(c=>c.expanded=false);
    }
});

// Source & Category buttons
document.querySelectorAll('.sources button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.sources button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const cat=document.querySelector('.categories button.active').dataset.category;
        fetchNews(btn.dataset.source,cat);
    });
});
document.querySelectorAll('.categories button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.categories button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const src=document.querySelector('.sources button.active').dataset.source;
        fetchNews(src,btn.dataset.category);
    });
});

document.getElementById('loadMoreBtn').addEventListener('click', displayNextBatch);

// Initial load
fetchNews();
setInterval(()=>{
    const src=document.querySelector('.sources button.active').dataset.source;
    const cat=document.querySelector('.categories button.active').dataset.category;
    fetchNews(src,cat);
},300000); // refresh every 5 min

</script>
</body>
</html>
