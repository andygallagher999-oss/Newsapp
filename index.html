<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<link rel="apple-touch-icon" href="logo.png">
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;}
header{display:flex;align-items:center;justify-content:center;padding:1rem;background:#2c3e50;color:#fff;font-size:1.5rem;}
header img{height:40px;margin-right:.6rem;}
.tab-bar{display:flex;flex-wrap:wrap;justify-content:center;background:#34495e;padding:.5rem;}
.tab-bar button{margin:.2rem;padding:.6rem 1.2rem;border:none;border-radius:6px;background:#ecf0f1;cursor:pointer;font-size:1rem;transition:background .2s;}
.tab-bar button.active{background:#e67e22;color:white;}
.tab-bar button:hover{background:#d0d3d4;}
#content{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1rem;padding:1rem;}
.card{background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden;display:flex;flex-direction:column;}
.card img{width:100%;object-fit:cover;height:160px;}
.title{font-weight:bold;margin:.5rem;cursor:pointer;color:#2c3e50;text-decoration:underline;}
.source,.date{font-size:.85rem;color:#7f8c8d;margin:0 .5rem .5rem;}
#backToTop{position:fixed;bottom:20px;right:20px;background:#e67e22;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:1.5rem;cursor:pointer;display:none;}
/* --- Mobile card: image left, text right --- */
@media(max-width:768px){
  #content{display:block;padding:.5rem;}
  .card{flex-direction:row;height:auto;margin-bottom:1rem;}
  .card img{width:35%;height:auto;border-radius:10px 0 0 10px;}
  .card .text-wrap{flex:1;padding:.5rem;display:flex;flex-direction:column;}
  .card .title{margin:.2rem 0;}
  .card .source,.card .date{margin:0;}
}
</style>
</head>
<body>
<header>
  <img src="logo.png" alt="logo">
  Global Lens
</header>

<div class="tab-bar" id="categoryTabs"></div>
<div id="content"></div>
<button id="backToTop">â†‘</button>

<script>
// === CONFIG ===
const RSS2JSON_API = 'YOUR_API_KEY_HERE'; // replace with your rss2json key
const PLACEHOLDER_LOGO = 'logo.png';

const categories = {
  "Sports": [
    "https://sports.nbcsports.com/feed/",
    "https://globalnews.ca/sports/feed/",
    "https://www.sportsnet.ca/feed/"
  ],
  "Business": [
    "https://www.reuters.com/business/rss",
    "https://www.cbc.ca/cmlink/rss-business",
    "https://www.bnnbreaking.com/rss"      // extra
  ],
  "News": [
    "https://www.cbc.ca/cmlink/rss-topstories",
    "https://globalnews.ca/feed/",
    "https://www.ctvnews.ca/rss/ctvnews-ca-top-stories-public-rss-1.822009"
  ],
  "Entertainment": [
    "https://globalnews.ca/entertainment/feed/",
    "https://www.ctvnews.ca/entertainment/rss/ctvnews-ca-entertainment-public-rss-1.822289",
    "https://www.etonline.com/news/rss"
  ]
};

// === STATE ===
let activeCategory = "News";
const allArticles = {};
let loading = false;
const categoryTabs = document.getElementById('categoryTabs');

// Build category buttons
Object.keys(categories).forEach(cat=>{
  const b=document.createElement('button');
  b.textContent=cat;
  b.onclick=()=>{activeCategory=cat;render(true)};
  if(cat===activeCategory) b.classList.add('active');
  categoryTabs.appendChild(b);
});

// Helpers
function toEasternTime(d){const date=new Date(d);return new Date(date.getTime()-4*60*60*1000);}
function getImg(item){
  if(item.enclosure && item.enclosure.link) return item.enclosure.link;
  if(item.thumbnail) return item.thumbnail;
  const tmp=document.createElement('div'); tmp.innerHTML=item.description||'';
  const img=tmp.querySelector('img'); return img?img.src:PLACEHOLDER_LOGO;
}
async function fetchRSS(url,offset=0){
  const api=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&api_key=${RSS2JSON_API}&count=20`;
  try{
    const res=await fetch(api);
    const data=await res.json();
    if(data.status!=="ok") return [];
    return data.items.map(i=>({...i,source:data.feed.title}));
  }catch(e){console.error('RSS',url,e);return [];}
}

async function loadCategory(cat,append=false){
  if(loading) return;
  loading=true;
  if(!append) allArticles[cat]=[];
  for(const feed of categories[cat]){
    const items=await fetchRSS(feed);
    allArticles[cat]=append
      ? allArticles[cat].concat(items)
      : allArticles[cat].concat(items);
  }
  // remove duplicates
  const seen=new Set();
  allArticles[cat]=allArticles[cat].filter(a=>{
    if(seen.has(a.link)) return false; seen.add(a.link); return true;
  });
  loading=false;
}

// Render articles
function render(reset=false){
  Array.from(categoryTabs.children).forEach(b=>b.classList.toggle('active',b.textContent===activeCategory));
  const container=document.getElementById('content');
  if(reset) container.innerHTML='';
  const articles=(allArticles[activeCategory]||[]).sort((a,b)=>toEasternTime(b.pubDate)-toEasternTime(a.pubDate));
  articles.forEach(a=>{
    if(document.getElementById(a.guid)) return; // skip if already rendered
    const card=document.createElement('div'); card.className='card'; card.id=a.guid;
    const img=document.createElement('img'); img.src=getImg(a); img.onerror=()=>img.src=PLACEHOLDER_LOGO;
    const wrap=document.createElement('div'); wrap.className='text-wrap';
    const t=document.createElement('div'); t.className='title'; t.textContent=a.title; t.onclick=()=>window.open(a.link,'_blank');
    const s=document.createElement('div'); s.className='source'; s.textContent=a.source;
    const d=document.createElement('div'); d.className='date'; d.textContent=toEasternTime(a.pubDate).toLocaleString();
    wrap.appendChild(t); wrap.appendChild(s); wrap.appendChild(d);
    if(window.innerWidth<=768){card.appendChild(img); card.appendChild(wrap);}
    else{card.appendChild(img); card.appendChild(t); card.appendChild(s); card.appendChild(d);}
    container.appendChild(card);
  });
}

// Back to top
const backToTop=document.getElementById('backToTop');
backToTop.onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
window.onscroll=()=>{
  backToTop.style.display=window.scrollY>300?'block':'none';
  // infinite scroll
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-100){
    loadCategory(activeCategory,true).then(()=>render());
  }
};

// Init
(async()=>{
  await loadCategory(activeCategory);
  render(true);
})();
</script>
</body>
</html>
