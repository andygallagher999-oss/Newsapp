<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Lens</title>
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        min-height:100vh;
        padding:10px;
        padding-bottom:80px;
    }
    .container { max-width:1200px; margin:0 auto; }
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; color:white; flex-wrap:wrap; }
    .header h1 { font-size:clamp(1.8rem,5vw,2.5rem); text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    .header #currentDate { font-size:1rem; }
    .buttons { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
    .buttons-left { justify-content:flex-start; }
    .buttons-right { justify-content:flex-end; }
    .buttons button {
        padding:10px 15px; border:none; border-radius:10px; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s; background:#fff; color:#333;
    }
    .buttons button.active { background:linear-gradient(45deg,#667eea,#764ba2); color:white; }
    .news-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-top:20px; }
    .news-card { background:white; border-radius:15px; overflow:hidden; box-shadow:0 8px 25px rgba(0,0,0,0.1); transition:all 0.3s ease; cursor:pointer; opacity:0; transform:translateY(20px); animation:fadeInUp 0.6s ease forwards; }
    .news-card:hover { transform:translateY(-3px); box-shadow:0 15px 35px rgba(0,0,0,0.15); }
    @keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }
    .news-image { width:100%; height:180px; object-fit:cover; background:#f0f2f5; }
    .news-content { padding:18px; }
    .news-source { display:inline-block; background:linear-gradient(45deg,#667eea,#764ba2); color:white; padding:4px 10px; border-radius:15px; font-size:11px; font-weight:600; margin-bottom:10px; text-transform:uppercase; }
    .news-title { font-size:1.1rem; font-weight:700; color:#2c3e50; margin-bottom:10px; line-height:1.4; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
    .news-summary { color:#555; line-height:1.5; margin-bottom:12px; font-size:0.9rem; display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden; }
    .news-meta { display:flex; justify-content:space-between; align-items:center; padding-top:12px; border-top:1px solid #eee; font-size:0.85rem; color:#888; }
    .news-date { font-weight:500; }
    .read-more { color:#667eea; text-decoration:none; font-weight:600; font-size:0.85rem; }
    .loading { text-align:center; color:white; font-size:1rem; margin:30px 0; padding:20px; }
    .spinner { display:inline-block; width:25px; height:25px; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 1s ease-in-out infinite; margin-right:10px; }
    @keyframes spin { to{transform:rotate(360deg);} }
    .refresh-btn { position:fixed; top:20px; right:20px; background:rgba(255,255,255,0.2); color:white; border:none; border-radius:50%; width:50px; height:50px; font-size:20px; cursor:pointer; backdrop-filter:blur(10px); transition:all 0.3s ease; z-index:100; }
    .refresh-btn:hover { background:rgba(255,255,255,0.3); transform:scale(1.1); }
    .error { background:rgba(255,107,107,0.15); color:#ff6b6b; padding:15px; border-radius:10px; text-align:center; margin:20px 0; border:1px solid rgba(255,107,107,0.2); }

    @media(max-width:768px){ 
        .news-grid { grid-template-columns:1fr; gap:15px; }
        .buttons button{ flex:1; font-size:16px; padding:12px; }
        .header{ flex-direction:column; align-items:flex-start; }
    }
</style>
</head>
<body>
<button class="refresh-btn" onclick="fetchNews()" title="Refresh News">üîÑ</button>

<div class="container">
    <div class="header">
        <h1>üåê Global Lens</h1>
        <div id="currentDate"></div>
    </div>

    <div class="buttons buttons-left" id="sourceButtons"></div>
    <div class="buttons buttons-right" id="categoryButtons"></div>

    <div id="loading" class="loading" style="display:none;">
        <div class="spinner"></div>Fetching from RSS feeds...
    </div>

    <div id="error" class="error" style="display:none;"></div>
    <div id="newsContainer" class="news-grid"></div>
</div>

<script>
const RSS_SOURCES={
    'bbc':{world:'http://feeds.bbci.co.uk/news/world/rss.xml', business:'http://feeds.bbci.co.uk/news/business/rss.xml', technology:'http://feeds.bbci.co.uk/news/technology/rss.xml', science:'http://feeds.bbci.co.uk/news/science_and_environment/rss.xml', health:'http://feeds.bbci.co.uk/news/health/rss.xml', sports:'http://feeds.bbci.co.uk/sport/rss.xml'},
    'cnn':{world:'http://rss.cnn.com/rss/edition.rss', business:'http://rss.cnn.com/rss/money_latest.rss', technology:'http://rss.cnn.com/rss/edition_technology.rss', science:'http://rss.cnn.com/rss/edition_space.rss', health:'http://rss.cnn.com/rss/edition_health.rss', sports:'http://rss.cnn.com/rss/edition_sport.rss'},
    'reuters':{world:'https://feeds.reuters.com/reuters/topNews', business:'https://feeds.reuters.com/reuters/businessNews', technology:'https://feeds.reuters.com/reuters/technologyNews', science:'https://feeds.reuters.com/reuters/scienceNews', health:'https://feeds.reuters.com/reuters/healthNews', sports:'https://feeds.reuters.com/reuters/sportsNews'},
    'ap':{world:'https://feeds.apnews.com/rss/apf-topnews', business:'https://feeds.apnews.com/rss/apf-business', technology:'https://feeds.apnews.com/rss/apf-technology', science:'https://feeds.apnews.com/rss/apf-science', health:'https://feeds.apnews.com/rss/apf-health', sports:'https://feeds.apnews.com/rss/apf-sports'},
    'guardian':{world:'https://www.theguardian.com/world/rss', business:'https://www.theguardian.com/business/rss', technology:'https://www.theguardian.com/technology/rss', science:'https://www.theguardian.com/science/rss', health:'https://www.theguardian.com/society/health/rss', sports:'https://www.theguardian.com/sport/rss'},
    'nyt':{world:'https://rss.nytimes.com/services/xml/rss/nyt/World.xml', business:'https://rss.nytimes.com/services/xml/rss/nyt/Business.xml', technology:'https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml', science:'https://rss.nytimes.com/services/xml/rss/nyt/Science.xml', health:'https://rss.nytimes.com/services/xml/rss/nyt/Health.xml', sports:'https://rss.nytimes.com/services/xml/rss/nyt/Sports.xml'},
    'techcrunch':{world:'https://feeds.feedburner.com/TechCrunch/', business:'https://feeds.feedburner.com/TechCrunch/', technology:'https://feeds.feedburner.com/TechCrunch/', science:'https://feeds.feedburner.com/TechCrunch/', health:'https://feeds.feedburner.com/TechCrunch/', sports:'https://feeds.feedburner.com/TechCrunch/'},
    'usatoday':{world:'https://rssfeeds.usatoday.com/UsatodaycomWorld-TopStories', business:'https://rssfeeds.usatoday.com/UsatodaycomMoney-Business', technology:'https://rssfeeds.usatoday.com/UsatodaycomTech-TopStories', science:'https://rssfeeds.usatoday.com/UsatodaycomTech-TopStories', health:'https://rssfeeds.usatoday.com/UsatodaycomHealth-TopStories', sports:'https://rssfeeds.usatoday.com/UsatodaycomSports-TopStories'},
    'npr':{world:'https://feeds.npr.org/1004/rss.xml', business:'https://feeds.npr.org/1019/rss.xml', technology:'https://feeds.npr.org/1017/rss.xml', science:'https://feeds.npr.org/1007/rss.xml', health:'https://feeds.npr.org/1128/rss.xml', sports:'https://feeds.npr.org/1002/rss.xml'},
    'cbc':{world:'https://www.cbc.ca/cmlink/rss-world', business:'https://www.cbc.ca/cmlink/rss-business', technology:'https://www.cbc.ca/cmlink/rss-technology', science:'https://www.cbc.ca/cmlink/rss-science', health:'https://www.cbc.ca/cmlink/rss-health', sports:'https://www.cbc.ca/cmlink/rss-sports'}
};

const SOURCES=['mixed','bbc','cnn','reuters','ap','guardian','nyt','techcrunch','usatoday','npr','cbc'];
const CATEGORIES=['world','business','technology','science','health','sports'];

let selectedSource='mixed', selectedCategory='world';

function formatDate(dateString){
    const date=new Date(dateString); const now=new Date();
    const diffTime=Math.abs(now-date);
    const diffHours=Math.floor(diffTime/(1000*60*60));
    const diffDays=Math.floor(diffTime/(1000*60*60*24));
    if(diffHours<1)return'Just now';
    if(diffHours<24)return`${diffHours}h ago`;
    if(diffDays<7)return`${diffDays}d ago`;
    return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function generateSummary(desc,content){
    let text=desc||content||'';
    text=text.replace(/<[^>]*>/g,''); text=text.replace(/&[^;]+;/g,' ');
    const sentences=text.split(/[.!?]+/);
    if(sentences.length>1 && sentences[0].length>50){return sentences.slice(0,2).join('. ').trim()+'.';}
    return text.length>200?text.substring(0,200).trim()+'...':text;
}

function getRandomImage(category){
    const images={world:['https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=200&fit=crop'], business:['https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=200&fit=crop'], technology:['https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=200&fit=crop'], science:['https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=400&h=200&fit=crop'], health:['https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=400&h=200&fit=crop'], sports:['https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=200&fit=crop']};
    const catImages=images[category]||images.world; return catImages[Math.floor(Math.random()*catImages.length)];
}

function createNewsCard(article,sourceName){
    const summary=generateSummary(article.description,article.content);
    const imageUrl=getRandomImage(selectedCategory);
    return `<div class="news-card" onclick="window.open('${article.link}','_blank')">
        <img src="${imageUrl}" alt="News Image" class="news-image" onerror="this.src='${getRandomImage(selectedCategory)}'">
        <div class="news-content">
            <div class="news-source">${sourceName}</div>
            <h3 class="news-title">${article.title}</h3>
            <p class="news-summary">${summary}</p>
            <div class="news-meta">
                <span class="news-date">${formatDate(article.pubDate)}</span>
                <span class="read-more">Read More ‚Üí</span>
            </div>
        </div>
    </div>`;
}

function displayNews(articles){
    document.getElementById('newsContainer').innerHTML=articles.map(a=>createNewsCard(a.item,a.source)).join('');
}

function showLoading(show){
    document.getElementById('loading').style.display=show?'block':'none';
}

function showError(message){
    const e=document.getElementById('error'); e.textContent=message; e.style.display='block';
    setTimeout(()=>{e.style.display='none';},5000);
}

async function parseRSSFeed(url,sourceName){
    try{
        const cacheKey=`rssCache_${sourceName}_${url}`;
        const cached=localStorage.getItem(cacheKey);
        const cachedTime=localStorage.getItem(cacheKey+'_time');
        const now=Date.now(); const CACHE_DURATION=10*60*1000;
        if(cached && cachedTime && (now-cachedTime<CACHE_DURATION)) return JSON.parse(cached);
        const proxyUrl=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&api_key=&count=10`;
        const res=await fetch(proxyUrl); const data=await res.json();
        if(data.status!=='ok')throw new Error(data.message||'RSS parsing failed');
        const items=data.items.map(item=>({source:sourceName,item:{title:item.title,description:item.description,content:item.content,link:item.link,pubDate:item.pubDate}}));
        localStorage.setItem(cacheKey,JSON.stringify(items));
        localStorage.setItem(cacheKey+'_time',now);
        return items;
    }catch(err){ console.error(`Error parsing RSS from ${sourceName}:`,err); return[];}
}

function getSourceDisplayName(source){
    const names={'bbc':'BBC News','cnn':'CNN','reuters':'Reuters','ap':'Associated Press','guardian':'The Guardian','nyt':'New York Times','techcrunch':'TechCrunch','usatoday':'USA Today','npr':'NPR','cbc':'CBC'};
    return names[source]||source.toUpperCase();
}

async function fetchNews(){
    showLoading(true);
    document.getElementById('newsContainer').innerHTML='';
    try{
        let allArticles=[];
        if(selectedSource==='mixed'){
            const sources=['bbc','cnn','reuters','ap','guardian','nyt','techcrunch','usatoday','npr','cbc'];
            const results=await Promise.allSettled(sources.map(async s=>parseRSSFeed(RSS_SOURCES[s][selectedCategory],getSourceDisplayName(s))));
            results.forEach(r=>{if(r.status==='fulfilled') allArticles.push(...r.value);});
        }else{
            allArticles=await parseRSSFeed(RSS_SOURCES[selectedSource][selectedCategory],getSourceDisplayName(selectedSource));
        }
        const goodArticles=allArticles.filter(a=>a.item.title&&a.item.description&&a.item.title.length>20&&a.item.description.length>50)
            .sort((a,b)=>new Date(b.item.pubDate)-new Date(a.item.pubDate))
            .slice(0,12);
        if(goodArticles.length===0)throw new Error('No articles found. Try a different source/category.');
        displayNews(goodArticles);
    }catch(err){ console.error(err); showError(`Failed to fetch news: ${err.message}`);}
    finally{ showLoading(false); }
}

// Buttons setup
const sourceContainer=document.getElementById('sourceButtons');
SOURCES.forEach(s=>{
    const b=document.createElement('button'); b.textContent=s==='mixed'?'Mixed':getSourceDisplayName(s); 
    if(s==='mixed') b.classList.add('active'); 
    b.onclick=()=>{selectedSource=s; document.querySelectorAll('#sourceButtons button').forEach(btn=>btn.classList.remove('active')); b.classList.add('active'); fetchNews();};
    sourceContainer.appendChild(b);
});
const categoryContainer=document.getElementById('categoryButtons');
CATEGORIES.forEach(c=>{
    const b=document.createElement('button'); b.textContent=c.charAt(0).toUpperCase()+c.slice(1); if(c==='world') b.classList.add('active');
    b.onclick=()=>{selectedCategory=c; document.querySelectorAll('#categoryButtons button').forEach(btn=>btn.classList.remove('active')); b.classList.add('active'); fetchNews();};
    categoryContainer.appendChild(b);
});

// Current date
function updateDate(){ document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'short',day:'numeric'});}
updateDate(); setInterval(updateDate,60*1000);

// Auto-load
setTimeout(fetchNews,500);
</script>
</body>
</html>
